# Tools

Utility functions for working with robot models.

## Proto to URDF Converter

::: pib3.tools.proto_converter.convert_proto_to_urdf
    options:
      show_root_heading: true
      show_source: true

### Purpose

The PIB robot is originally defined in Webots' `.proto` format. This tool converts it to URDF (Unified Robot Description Format) for use with roboticstoolbox-python.

!!! note "Pre-generated URDF"
    The package includes a pre-generated URDF file. You only need this tool if you modify the Webots proto file.

### Usage

```python
from pib3.tools import convert_proto_to_urdf

# Convert proto to URDF
urdf_string = convert_proto_to_urdf(
    proto_path="pibsim_webots/protos/pib.proto",
    urdf_path="pib_model.urdf",
)

print(f"Generated URDF with {urdf_string.count('<link')} links")
```

### Command Line

```bash
python -m pib3.tools.proto_converter
```

This generates `pib_model.urdf` from the default proto location.

### Conversion Details

The converter handles:

| Webots Concept | URDF Equivalent |
|----------------|-----------------|
| `Solid` | `<link>` |
| `HingeJoint` | `<joint type="revolute">` |
| `Transform` | Visual/collision `<origin>` |
| `Shape` with `Mesh` | `<visual>` and `<collision>` |
| `Physics` | `<inertial>` |
| Motor limits | `<limit>` |

### Coordinate System

The canonical format uses **Webots motor radians** directly. The URDF generated by this converter uses the same coordinate system as Webots motors.

Swift visualization requires a **-1.0 radian offset** from canonical values. This offset is applied in `SwiftBackend`, not baked into the URDF.

### Example Output

```xml
<?xml version="1.0"?>
<robot name="pib">
  <link name="base_link">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry><mesh filename="urdf_body.stl"/></geometry>
    </visual>
  </link>

  <joint name="shoulder_vertical_left" type="revolute">
    <parent link="base_link"/>
    <child link="urdf_shoulder_vertical_1"/>
    <origin xyz="0.085 0.055 0.362" rpy="..."/>
    <axis xyz="0 1 0"/>
    <limit lower="0" upper="3.14" effort="10" velocity="20"/>
  </joint>

  <!-- ... more links and joints ... -->
</robot>
```

## Calibration Tool

For calibrating joint limits on the real robot, see the [Calibration Guide](../getting-started/calibration.md).

## Internal Utilities

### Vector Math Functions

The proto converter includes internal vector/matrix utilities:

```python
# Not part of public API, but documented for reference:

normalize(v)           # Normalize 3D vector
axis_angle_to_matrix() # Convert axis-angle to rotation matrix
matrix_to_rpy()        # Convert matrix to roll-pitch-yaw
```

These are used internally for coordinate transformations during URDF generation.
